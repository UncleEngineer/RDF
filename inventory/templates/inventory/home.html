{% extends 'inventory/base.html' %}
{% block title %}‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö{% endblock %}

{% block content %}
<h2>üìã ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö ({{ request.user.username }})</h2>

<!-- ‡πÅ‡∏™‡∏î‡∏á Messages -->
{% if messages %}
  {% for message in messages %}
    <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
      {{ message }}
      <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
  {% endfor %}
{% endif %}

<div class="d-flex justify-content-between align-items-center mb-3">
  <a href="{% url 'order_material' %}" class="btn btn-success">
    <i class="fas fa-plus"></i> ‚ûï ‡∏™‡∏±‡πà‡∏á‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö
  </a>
  <div>
    <small class="text-muted">
      <span class="badge bg-warning">‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</span>
      <span class="badge bg-success">‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß</span>
      <span class="badge bg-danger">‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</span>
    </small>
  </div>
</div>

<div class="table-responsive">
  <table class="table table-striped table-bordered">
    <thead class="table-dark">
      <tr>
        <th>‡∏£‡∏´‡∏±‡∏™‡∏≠‡∏≠‡∏£‡πå‡πÄ‡∏î‡∏≠‡∏£‡πå</th>
        <th>‡∏ú‡∏π‡πâ‡∏™‡∏±‡πà‡∏á</th>
        <th>‡∏£‡∏≠‡∏ö‡∏à‡∏±‡∏î‡∏™‡πà‡∏á</th>
        <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏±‡πà‡∏á</th>
        <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
        <th>‡∏ú‡∏π‡πâ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</th>
        <th>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</th>
        <th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</th>
        <th>‡∏£‡∏ß‡∏°‡∏ï‡πâ‡∏ô‡∏ó‡∏∏‡∏ô</th>
        <th>‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
      </tr>
    </thead>
    <tbody>
      {% for order in orders %}
      
      <tr>
        <td>
          <strong>MOD-{{ order.id|stringformat:"05d" }}</strong>
        </td>
        <td>{{ order.ordered_by.username }}</td>
        <td>
          {% if order.delivery_round %}
            <span class="badge bg-info">{{ order.delivery_round.name }}</span>
          {% else %}
            <span class="text-muted">-</span>
          {% endif %}
        </td>
        <td>{{ order.created_at|date:"Y-m-d H:i" }}</td>
        <td>
          {% if order.approval_status == 'pending' %}
            <span class="badge bg-warning">‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</span>
          {% elif order.approval_status == 'approved' %}
            <span class="badge bg-success">‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß</span>
          {% elif order.approval_status == 'rejected' %}
            <span class="badge bg-danger">‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</span>
          {% endif %}
        </td>
        <td>
          {% if order.approved_by %}
            {{ order.approved_by.username }}
            {% if order.approved_at %}
              <br><small class="text-muted">{{ order.approved_at|date:"m/d H:i" }}</small>
            {% endif %}
          {% else %}
            <span class="text-muted">-</span>
          {% endif %}
        </td>
        <td>
          {% if order.note %}
            <span title="{{ order.note }}">
              {{ order.note|truncatechars:30 }}
            </span>
          {% else %}
            <span class="text-muted">-</span>
          {% endif %}
        </td>
        <td>
          <span class="badge bg-secondary">{{ order.items.count }}</span>
        </td>
        <td>
          <strong class="text-primary">{{ order.total_cost|floatformat:2 }}</strong> ‡∏ö‡∏≤‡∏ó
        </td>
        <td>
          <div class="btn-group btn-group-sm" role="group">
            {% if order.approval_status == 'approved' %}
              <a href="{% url 'order_edit' order.id %}" class="btn btn-primary" title="‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç">
                ‚úèÔ∏è
              </a>
              <a href="{% url 'order_delete' order.id %}" class="btn btn-danger" title="‡∏•‡∏ö">
                üóëÔ∏è
              </a>
            {% else %}
              <span class="text-muted small">‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏î‡πâ</span>
            {% endif %}
          </div>
        </td>
      </tr>
      
      {% empty %}
      <tr>
        <td colspan="10" class="text-center text-muted py-4">
          <i class="fas fa-inbox fa-3x mb-3"></i><br>
          ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠<br>
          <a href="{% url 'order_material' %}" class="btn btn-success btn-sm mt-2">
            ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡πÄ‡∏•‡∏¢
          </a>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<!-- ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏™‡∏£‡∏∏‡∏õ -->
<div class="row mt-4">
  <div class="col-md-3">
    <div class="card text-center">
      <div class="card-body">
        <h5 class="card-title text-primary">{{ total_order }}</h5>
        <p class="card-text">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
      </div>
    </div>
  </div>
  <div class="col-md-3">
    <div class="card text-center">
      <div class="card-body">
        <h5 class="card-title text-warning">
          {{ total_cost }}
        </h5>
        <p class="card-text">‡∏¢‡∏≠‡∏î‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</p>
      </div>
    </div>
  </div>
 
  
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
{% endblock %}